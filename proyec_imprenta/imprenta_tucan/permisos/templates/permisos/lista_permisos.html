{% extends 'layouts/list_base.html' %}
{% block title %}Permisos{% endblock %}

{% block list_icon %}<span class="material-symbols-outlined text-3xl">vpn_key</span>{% endblock %}
{% block list_title_text %}Lista de Permisos{% endblock %}
{% block new_button_href %}{% url 'alta_permiso' %}{% endblock %}
{% block new_button_label %}Nuevo Permiso{% endblock %}
{% block search_placeholder %}Nombre, descripción, módulo, estado...{% endblock %}
{% block clear_url %}{% url 'lista_permisos' %}{% endblock %}
{% block order_fields_options %}
  <option value="id" {% if order_by == 'id' %}selected{% endif %}>ID</option>
  <option value="nombre" {% if order_by == 'nombre' %}selected{% endif %}>Nombre</option>
  <option value="descripcion" {% if order_by == 'descripcion' %}selected{% endif %}>Descripción</option>
  <option value="modulo" {% if order_by == 'modulo' %}selected{% endif %}>Módulo</option>
  <option value="estado" {% if order_by == 'estado' %}selected{% endif %}>Estado</option>
{% endblock %}

{% block list_content %}

  <!-- Tabla -->
  <div class="bg-white shadow rounded-xl overflow-hidden table-responsive">
    <div class="px-4 py-3 border-b flex justify-between items-center bg-white">
      <div class="text-sm text-gray-600">Total permisos: <span class="font-semibold">{{ permisos.paginator.count }}</span></div>
    </div>
    <table class="w-full min-w-[980px] text-left text-sm" aria-describedby="Tabla de permisos del sistema">
      <thead class="bg-gray-100 text-left text-xs uppercase text-gray-600">
        <tr>
          <th class="px-4 py-3">ID</th>
          <th class="px-4 py-3">Nombre del Permiso</th>
          <th class="px-4 py-3">Descripción</th>
          <th class="px-4 py-3">Módulo</th>
          <!-- <th class="px-4 py-3">Acciones</th> -->
          <th class="px-4 py-3">Estado</th>
          <th class="px-4 py-3">Opciones</th>
        </tr>
      </thead>
      <tbody>
        {% for permiso in permisos %}
          <tr class="border-t hover:bg-gray-50 transition-colors">
            <td class="px-4 py-2 align-top text-gray-700">{{ permiso.id }}</td>
            <td class="px-4 py-2 align-top font-medium max-w-[180px] break-words">{{ permiso.nombre }}</td>
            <td class="px-4 py-2 align-top text-gray-600 max-w-[240px] break-words" title="{{ permiso.descripcion }}">
              {% if permiso.descripcion|length > 120 %}
                {{ permiso.descripcion|slice:":120" }}…
              {% else %}
                {{ permiso.descripcion }}
              {% endif %}
            </td>
            <td class="px-4 py-2 align-top">{{ permiso.modulo }}</td>
            <!-- <td class="px-4 py-2 align-top w-[240px]">
              {% if permiso.acciones %}
                {% for accion in permiso.acciones %}
                  <span class="inline-flex items-center gap-1 bg-blue-50 text-blue-800 text-xs font-medium px-2 py-1 rounded mb-1 mr-1">
                    <span class="material-symbols-outlined text-[14px]">task_alt</span>{{ accion }}
                  </span>
                {% endfor %}
              {% else %}
                <span class="text-xs text-gray-400">— Sin acciones —</span>
              {% endif %}
            </td -->
            <td class="px-4 py-2 align-top">
              {% if permiso.estado == 'Activo' %}
                <span class="inline-flex items-center gap-1 text-green-600 font-semibold text-sm"><span class="material-symbols-outlined text-[16px]">verified</span>{{ permiso.estado }}</span>
              {% else %}
                <span class="inline-flex items-center gap-1 text-red-600 font-semibold text-sm"><span class="material-symbols-outlined text-[16px]">error</span>{{ permiso.estado }}</span>
              {% endif %}
            </td>
            <td class="px-4 py-2 align-top">
              <div class="flex flex-wrap gap-2">
                <a href="{% url 'modificar_permiso' permiso.id %}"
                   class="inline-flex items-center px-3 py-1 rounded bg-blue-100 text-blue-700 hover:bg-blue-200 text-xs"
                   title="Editar permiso" aria-label="Editar permiso">
                  <span class="material-symbols-outlined text-base">edit</span>
                </a>
                <a href="{% url 'detalle_permiso' permiso.id %}"
                   class="inline-flex items-center px-3 py-1 rounded bg-indigo-100 text-indigo-700 hover:bg-indigo-200 text-xs"
                   title="Ver permiso" aria-label="Ver permiso">
                  <span class="material-symbols-outlined text-base">visibility</span>
                </a>
                {% if permiso.estado == 'Activo' %}
                  <form method="post" action="{% url 'baja_permiso' permiso.id %}">
                    {% csrf_token %}
                    <button type="submit"
                            class="inline-flex items-center px-3 py-1 rounded bg-yellow-100 text-yellow-700 hover:bg-yellow-200 text-xs"
                            title="Desactivar permiso" aria-label="Desactivar permiso">
                      <span class="material-symbols-outlined text-base">block</span>
                    </button>
                  </form>
                {% else %}
                  <form method="post" action="{% url 'reactivar_permiso' permiso.id %}">
                    {% csrf_token %}
                    <button type="submit"
                            class="inline-flex items-center px-3 py-1 rounded bg-green-100 text-green-700 hover:bg-green-200 text-xs"
                            title="Activar permiso" aria-label="Activar permiso">
                      <span class="material-symbols-outlined text-base">check_circle</span>
                    </button>
                  </form>
                {% endif %}
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="7" class="px-4 py-6 text-center text-gray-500">
              <div class="flex flex-col items-center gap-2">
                <span class="material-symbols-outlined text-4xl text-gray-300">lock_open</span>
                <p class="text-sm">No se encontraron permisos.</p>
                <a href="{% url 'alta_permiso' %}" class="inline-flex items-center gap-1 px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 text-sm">
                  <span class="material-symbols-outlined text-sm">add</span>Crear primero
                </a>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

  {% include 'layouts/pagination.html' with page_obj=permisos %}
  </div>

{% endblock %}
