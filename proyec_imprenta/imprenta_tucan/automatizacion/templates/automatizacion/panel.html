{% extends 'usuarios/dashboard.html' %}
{% block extra_panels %}
<div class="flex justify-end mb-4">
  <a href="{% url 'dashboard' %}" class="inline-flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-4 rounded shadow">
    <span class="material-symbols-outlined text-base">arrow_back</span>
    Volver al Dashboard
  </a>
  </div>
<section class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
  <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
    <div class="flex items-center justify-between mb-3">
      <div class="flex items-center gap-3">
        <div class="h-12 w-12 rounded-full bg-blue-50 text-blue-700 grid place-items-center">
          <span class="material-symbols-outlined">auto_mode</span>
        </div>
        <div>
          <p class="text-sm text-gray-500">Automatización</p>
          <p class="text-lg font-bold">Órdenes sugeridas</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <button id="btnDemoAutomatizacion" class="text-xs px-2 py-1 rounded bg-gray-100 text-gray-700 hover:bg-gray-200" type="button">Generar demo</button>
        <a href="{% url 'automatizacion_ordenes' %}" class="text-xs text-blue-600 hover:underline">Ver todas</a>
      </div>
    </div>
    <ul id="ordenesResumen" class="text-sm space-y-1">
      {% for o in ordenes %}
        <li>Pedido {{ o.pedido_id }} · Insumo {{ o.insumo_id }} · Cant. {{ o.cantidad }}</li>
      {% empty %}
        <li class="text-gray-500">Sin órdenes sugeridas</li>
      {% endfor %}
    </ul>
  </div>
  <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm">
    <div class="flex items-center justify-between mb-3">
      <div class="flex items-center gap-3">
        <div class="h-12 w-12 rounded-full bg-pink-50 text-pink-700 grid place-items-center">
          <span class="material-symbols-outlined">local_offer</span>
        </div>
        <div>
          <p class="text-sm text-gray-500">Automatización</p>
          <p class="text-lg font-bold">Ofertas automáticas</p>
        </div>
      </div>
      <a href="{% url 'automatizacion_ofertas' %}" class="text-xs text-pink-600 hover:underline">Ver todas</a>
    </div>
    <ul id="ofertasResumen" class="text-sm space-y-1">
      {% for of in ofertas %}
        <li>{{ of.descripcion|truncatechars:80 }} · {% if of.fecha_inicio %}{{ of.fecha_inicio|date:'Y-m-d' }}{% endif %} → {% if of.fecha_fin %}{{ of.fecha_fin|date:'Y-m-d' }}{% endif %}</li>
      {% empty %}
        <li class="text-gray-500">Sin ofertas activas</li>
      {% endfor %}
    </ul>
  </div>
</section>
{% endblock %}
{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function(){
  const btnDemo = document.getElementById('btnDemoAutomatizacion');
  if (!btnDemo) return;
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
  }
  const csrftoken = getCookie('csrftoken');
  btnDemo.addEventListener('click', function(){
    fetch('{% url "automatizacion_demo" %}', {
      method: 'POST',
      headers: { 'X-CSRFToken': csrftoken, 'Content-Type': 'application/json' },
      body: JSON.stringify({})
    })
    .then(r => r.json())
    .then(_ => {
      // recargar la página para ver los nuevos datos
      window.location.reload();
    })
    .catch(_ => alert('Error al generar datos de demo'));
  });
});
</script>
{% endblock %}
