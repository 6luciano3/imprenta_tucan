{% extends 'base.html' %}
{% block title %}Gestión de Usuarios{% endblock %}

{% block content %}
<div class="px-4 md:px-10 lg:px-20 xl:px-40 py-5">
  <div class="max-w-7xl mx-auto">

    <!-- Mensajes del sistema -->
    {% if messages %}
      <div class="mb-6">
        {% for message in messages %}
          <div class="px-4 py-3 rounded-lg shadow text-white
                      {% if message.tags == 'success' %}bg-green-600
                      {% elif message.tags == 'error' %}bg-red-600
                      {% elif message.tags == 'warning' %}bg-yellow-500
                      {% else %}bg-gray-600{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="flex justify-between items-center mb-6">
      <h1 class="text-4xl font-black text-[#111418] dark:text-white">Gestión de Usuarios</h1>
    </div>

    <!-- Formulario de búsqueda -->
    <form method="get" class="flex flex-col md:flex-row items-end gap-4 mb-6">
      <label class="flex flex-col flex-1 min-w-40">
        <span class="text-base font-medium text-[#111418] dark:text-white pb-2">Buscar por nombre, email, etc.</span>
        <input type="text" name="criterio" value="{{ criterio }}" placeholder="Nombre, Apellido, Email, Teléfono"
               class="form-input h-14 p-[15px] text-base rounded-lg border border-[#dbe0e6] dark:border-gray-700 bg-white dark:bg-gray-800 text-[#111418] dark:text-white placeholder:text-[#617589] dark:placeholder:text-gray-400 focus:border-primary dark:focus:border-primary focus:outline-none focus:ring-0">
      </label>
      <div class="flex gap-3">
        <button type="submit"
                class="flex items-center gap-2 h-14 px-5 rounded-lg bg-primary text-white font-bold hover:bg-primary/90 transition">
          <span class="material-symbols-outlined">search</span> Buscar
        </button>
        <a href="{% url 'buscar_usuario' %}"
           class="flex items-center gap-2 h-14 px-5 rounded-lg bg-[#f0f2f4] dark:bg-gray-700 text-[#111418] dark:text-white font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition">
          Limpiar
        </a>
      </div>
    </form>

    <!-- Tabla de resultados -->
    <div class="overflow-x-auto border border-[#dbe0e6] dark:border-gray-700 rounded-lg bg-white dark:bg-background-dark">
      <table class="w-full text-sm">
        <thead class="bg-white dark:bg-gray-800">
          <tr>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">ID de Usuario</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Nombre</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Apellido</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Email</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Teléfono</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Rol</th>
            <th class="px-6 py-3 text-left text-[#111418] dark:text-white font-medium">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for usuario in usuarios %}
          <tr class="border-t border-[#dbe0e6] dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition">
            <td class="px-6 py-4 text-[#617589] dark:text-gray-400">{{ usuario.codigo }}</td>
            <td class="px-6 py-4 text-[#111418] dark:text-white">{{ usuario.nombre }}</td>
            <td class="px-6 py-4 text-[#111418] dark:text-white">{{ usuario.apellido }}</td>
            <td class="px-6 py-4 text-[#111418] dark:text-white">{{ usuario.email }}</td>
            <td class="px-6 py-4 text-[#111418] dark:text-white">{{ usuario.telefono }}</td>
            <td class="px-6 py-4 text-[#111418] dark:text-white">{{ usuario.rol.nombre }}</td>
            <td class="px-6 py-4 text-[#617589] dark:text-gray-400 font-bold">
              <div class="flex gap-2">
                <a href="{% url 'detalle_usuario' usuario.id %}" class="text-primary hover:text-primary/80 flex items-center gap-1">
                  <span class="material-symbols-outlined text-base">visibility</span> Ver Detalles
                </a>
                <a href="{% url 'modificar_usuario' usuario.id %}" class="text-yellow-600 hover:text-yellow-800 flex items-center gap-1">
                  <span class="material-symbols-outlined text-base">edit</span> Modificar
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="px-6 py-6 text-center text-gray-500 dark:text-gray-400">No se encontraron usuarios.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Paginación (estructura lista para integrar) -->
    {% if usuarios.has_other_pages %}
    <div class="mt-6 flex justify-center">
      <nav class="inline-flex gap-2">
        {% if usuarios.has_previous %}
          <a href="?criterio={{ criterio }}&page={{ usuarios.previous_page_number }}" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-[#111418] dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600">Anterior</a>
        {% endif %}
        {% for num in usuarios.paginator.page_range %}
          {% if usuarios.number == num %}
            <span class="px-4 py-2 rounded-lg bg-primary text-white font-bold">{{ num }}</span>
          {% else %}
            <a href="?criterio={{ criterio }}&page={{ num }}" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-[#111418] dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600">{{ num }}</a>
          {% endif %}
        {% endfor %}
        {% if usuarios.has_next %}
          <a href="?criterio={{ criterio }}&page={{ usuarios.next_page_number }}" class="px-4 py-2 rounded-lg bg-gray-200 dark:bg-gray-700 text-[#111418] dark:text-white hover:bg-gray-300 dark:hover:bg-gray-600">Siguiente</a>
        {% endif %}
      </nav>
    </div>
    {% endif %}

  </div>
</div>
{% endblock %}
